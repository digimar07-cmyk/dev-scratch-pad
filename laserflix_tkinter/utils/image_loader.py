"""\nUtils — Image Loader\nCarregamento e processamento de imagens (thumbnails, hero, galeria)\n"""\n\nimport os\nfrom PIL import Image, ImageTk\nfrom collections import OrderedDict\nfrom config import LOGGER\n\n\nclass ImageLoader:\n    def __init__(self, cache_limit=300):\n        self.thumbnail_cache = OrderedDict()\n        self.cache_limit = cache_limit\n\n    def _find_first_image_path(self, project_path):\n        """Retorna caminho da primeira imagem válida encontrada."""\n        valid_extensions = (".png", ".jpg", ".jpeg", ".gif", ".bmp", ".webp")\n        try:\n            for item in os.listdir(project_path):\n                if item.lower().endswith(valid_extensions):\n                    return os.path.join(project_path, item)\n        except Exception:\n            LOGGER.exception(f"Falha ao listar {project_path}")\n        return None\n\n    def _load_thumbnail_photo(self, img_path):\n        """Carrega imagem e redimensiona para thumbnail."""\n        img = Image.open(img_path)\n        img.thumbnail((220, 200), Image.Resampling.LANCZOS)\n        return ImageTk.PhotoImage(img)\n\n    def get_cover_image(self, project_path):\n        """Retorna PhotoImage da capa com cache LRU."""\n        img_path = self._find_first_image_path(project_path)\n        if not img_path:\n            return None\n        try:\n            mtime = os.path.getmtime(img_path)\n        except Exception:\n            return None\n        try:\n            cached = self.thumbnail_cache.get(img_path)\n            if cached:\n                cached_mtime, cached_photo = cached\n                if cached_mtime == mtime:\n                    self.thumbnail_cache.move_to_end(img_path)\n                    return cached_photo\n            photo = self._load_thumbnail_photo(img_path)\n            self.thumbnail_cache[img_path] = (mtime, photo)\n            self.thumbnail_cache.move_to_end(img_path)\n            while len(self.thumbnail_cache) > self.cache_limit:\n                self.thumbnail_cache.popitem(last=False)\n            return photo\n        except Exception:\n            LOGGER.exception(f"Erro ao gerar thumbnail de {img_path}")\n            return None\n\n    def get_hero_image(self, project_path):\n        """Retorna imagem hero (grande) para modal."""\n        try:\n            valid_extensions = (".png", ".jpg", ".jpeg", ".gif", ".bmp")\n            for item in os.listdir(project_path):\n                if item.lower().endswith(valid_extensions):\n                    img_path = os.path.join(project_path, item)\n                    img = Image.open(img_path)\n                    max_width = 800\n                    if img.width > max_width:\n                        ratio = max_width / img.width\n                        img = img.resize((max_width, int(img.height * ratio)), Image.Resampling.LANCZOS)\n                    return ImageTk.PhotoImage(img)\n        except Exception:\n            LOGGER.exception(f"Falha ao carregar hero image de {project_path}")\n        return None\n\n    def get_all_project_images(self, project_path):\n        """Retorna lista de paths de todas as imagens do projeto."""\n        valid_extensions = (".png", ".jpg", ".jpeg", ".gif", ".bmp")\n        images = []\n        try:\n            for item in os.listdir(project_path):\n                if item.lower().endswith(valid_extensions):\n                    images.append(os.path.join(project_path, item))\n        except Exception:\n            LOGGER.exception(f"Falha ao listar imagens de {project_path}")\n        return sorted(images)\n