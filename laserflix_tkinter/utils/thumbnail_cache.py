"""\nUtils — Thumbnail Cache\nCache LRU de thumbnails em memória\n"""\n\nimport os\nfrom collections import OrderedDict\nfrom config import LOGGER\nfrom utils.image_loader import ImageLoader\n\n\nclass ThumbnailCache:\n    def __init__(self, cache_limit=300):\n        self.cache = OrderedDict()\n        self.cache_limit = cache_limit\n\n    def get_cover_image(self, project_path):\n        """Retorna thumbnail com cache LRU."""\n        img_path = ImageLoader.find_first_image_path(project_path)\n        if not img_path:\n            return None\n        try:\n            mtime = os.path.getmtime(img_path)\n        except Exception:\n            return None\n        try:\n            # Verifica cache\n            cached = self.cache.get(img_path)\n            if cached:\n                cached_mtime, cached_photo = cached\n                if cached_mtime == mtime:\n                    self.cache.move_to_end(img_path)\n                    return cached_photo\n            # Carrega nova thumbnail\n            photo = ImageLoader.load_thumbnail_photo(img_path)\n            if photo:\n                self.cache[img_path] = (mtime, photo)\n                self.cache.move_to_end(img_path)\n                # Limpa cache se exceder limite\n                while len(self.cache) > self.cache_limit:\n                    self.cache.popitem(last=False)\n            return photo\n        except Exception:\n            LOGGER.exception(f"Erro ao gerar thumbnail de {img_path}")\n            return None\n\n    def clear(self):\n        """Limpa cache completamente."""\n        self.cache.clear()\n