"""\nUI ‚Äî Project Modal\nModal de detalhes do projeto\n"""\n\nimport tkinter as tk\nfrom tkinter import scrolledtext\nfrom utils.image_loader import ImageLoader\nfrom utils.ui_helpers import UIHelpers\n\n\nclass ProjectModal:\n    def __init__(self, parent, project_path, data, callbacks):\n        """\n        callbacks: dict com {\n            'save': func(project_path, updated_data),\n            'generate_description': func(project_path),\n            'open_image': func(image_path)\n        }\n        """\n        self.parent = parent\n        self.project_path = project_path\n        self.data = data\n        self.callbacks = callbacks\n        self.modal = None\n        self.create_modal()\n\n    def create_modal(self):\n        """Cria janela modal."""\n        self.modal = tk.Toplevel(self.parent)\n        self.modal.title(self.data.get("name", "Detalhes"))\n        self.modal.geometry("900x700")\n        self.modal.configure(bg="#141414")\n        self.modal.transient(self.parent)\n        self.modal.grab_set()\n\n        # Container com scroll\n        canvas = tk.Canvas(self.modal, bg="#141414", highlightthickness=0)\n        scrollbar = tk.Scrollbar(self.modal, orient="vertical", command=canvas.yview)\n        scrollable_frame = tk.Frame(canvas, bg="#141414")\n\n        scrollable_frame.bind(\n            "<Configure>",\n            lambda e: canvas.configure(scrollregion=canvas.bbox("all"))\n        )\n\n        canvas.create_window((0, 0), window=scrollable_frame, anchor="nw")\n        canvas.configure(yscrollcommand=scrollbar.set)\n\n        canvas.pack(side="left", fill="both", expand=True)\n        scrollbar.pack(side="right", fill="y")\n\n        # Conte√∫do\n        self._create_content(scrollable_frame)\n\n    def _create_content(self, parent):\n        """Cria conte√∫do do modal."""\n        # Imagem hero\n        hero_img = ImageLoader.get_hero_image(self.project_path)\n        if hero_img:\n            img_label = tk.Label(parent, image=hero_img, bg="#141414")\n            img_label.image = hero_img\n            img_label.pack(pady=10)\n\n        # Nome\n        name_label = tk.Label(parent, text=self.data.get("name", "Sem nome"),\n                            font=("Arial", 16, "bold"), bg="#141414", fg="#FFFFFF")\n        name_label.pack(pady=10)\n\n        # Categorias\n        cat_frame = tk.Frame(parent, bg="#141414")\n        cat_frame.pack(fill="x", padx=20, pady=10)\n        tk.Label(cat_frame, text="Categorias:", font=("Arial", 11, "bold"),\n                bg="#141414", fg="#FFFFFF").pack(side="left", padx=5)\n        self.cat_listbox = tk.Listbox(cat_frame, height=5, bg="#2A2A2A", fg="#FFFFFF")\n        self.cat_listbox.pack(side="left", fill="x", expand=True, padx=5)\n        for cat in self.data.get("categories", []):\n            self.cat_listbox.insert(tk.END, cat)\n        tk.Button(cat_frame, text="+", command=lambda: UIHelpers.add_tag_to_listbox(self.cat_listbox, self.modal)).pack(side="left")\n        tk.Button(cat_frame, text="-", command=lambda: UIHelpers.remove_tag_from_listbox(self.cat_listbox)).pack(side="left")\n\n        # Tags\n        tag_frame = tk.Frame(parent, bg="#141414")\n        tag_frame.pack(fill="x", padx=20, pady=10)\n        tk.Label(tag_frame, text="Tags:", font=("Arial", 11, "bold"),\n                bg="#141414", fg="#FFFFFF").pack(side="left", padx=5)\n        self.tag_listbox = tk.Listbox(tag_frame, height=5, bg="#2A2A2A", fg="#FFFFFF")\n        self.tag_listbox.pack(side="left", fill="x", expand=True, padx=5)\n        for tag in self.data.get("tags", []):\n            self.tag_listbox.insert(tk.END, tag)\n        tk.Button(tag_frame, text="+", command=lambda: UIHelpers.add_tag_to_listbox(self.tag_listbox, self.modal)).pack(side="left")\n        tk.Button(tag_frame, text="-", command=lambda: UIHelpers.remove_tag_from_listbox(self.tag_listbox)).pack(side="left")\n\n        # Descri√ß√£o\n        desc_frame = tk.Frame(parent, bg="#141414")\n        desc_frame.pack(fill="both", expand=True, padx=20, pady=10)\n        tk.Label(desc_frame, text="Descri√ß√£o:", font=("Arial", 11, "bold"),\n                bg="#141414", fg="#FFFFFF").pack(anchor="w")\n        self.desc_text = scrolledtext.ScrolledText(desc_frame, height=10, wrap=tk.WORD,\n                                                  bg="#2A2A2A", fg="#FFFFFF", font=("Arial", 10))\n        self.desc_text.pack(fill="both", expand=True)\n        self.desc_text.insert("1.0", self.data.get("ai_description", ""))\n\n        # Bot√µes\n        btn_frame = tk.Frame(parent, bg="#141414")\n        btn_frame.pack(pady=20)\n        tk.Button(btn_frame, text="üìù Gerar Descri√ß√£o", bg="#E50914", fg="white",\n                 font=("Arial", 10, "bold"), command=self._generate_description).pack(side="left", padx=5)\n        tk.Button(btn_frame, text="‚úì Salvar", bg="#00AA00", fg="white",\n                 font=("Arial", 10, "bold"), command=self._save).pack(side="left", padx=5)\n        tk.Button(btn_frame, text="Fechar", bg="#666666", fg="white",\n                 font=("Arial", 10, "bold"), command=self.modal.destroy).pack(side="left", padx=5)\n\n    def _generate_description(self):\n        """Gera descri√ß√£o com IA."""\n        if self.callbacks.get('generate_description'):\n            desc = self.callbacks['generate_description'](self.project_path)\n            if desc:\n                self.desc_text.delete("1.0", tk.END)\n                self.desc_text.insert("1.0", desc)\n\n    def _save(self):\n        """Salva altera√ß√µes."""\n        updated_data = dict(self.data)\n        updated_data["categories"] = list(self.cat_listbox.get(0, tk.END))\n        updated_data["tags"] = list(self.tag_listbox.get(0, tk.END))\n        updated_data["ai_description"] = self.desc_text.get("1.0", tk.END).strip()\n        if self.callbacks.get('save'):\n            self.callbacks['save'](self.project_path, updated_data)\n        self.modal.destroy()\n